{"version":3,"file":"key-sequence.condition-DuE-ts7p.js","sources":["../../../Client/src/conditions/key-sequence.service.ts","../../../Client/src/conditions/key-sequence.condition.ts"],"sourcesContent":["import { UmbControllerBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\n\r\nexport class KeySequenceService extends UmbControllerBase {\r\n  private _keySequence: string[] = [];\r\n  private _targetSequence = [\"ArrowUp\", \"ArrowUp\", \"ArrowDown\", \"ArrowDown\", \"ArrowLeft\", \"ArrowRight\"];\r\n  private _isActivated = false;\r\n  private _timeoutId?: number;\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host);\r\n    this.#setupKeyListener();\r\n  }\r\n\r\n  #setupKeyListener() {\r\n    document.addEventListener(\"keydown\", this.#handleKeyPress);\r\n  }\r\n\r\n  #handleKeyPress = (event: KeyboardEvent) => {\r\n    // Clear timeout if exists\r\n    if (this._timeoutId) {\r\n      window.clearTimeout(this._timeoutId);\r\n    }\r\n\r\n    // Add the key to sequence\r\n    this._keySequence.push(event.key);\r\n\r\n    // Keep only the last N keys where N is the target sequence length\r\n    if (this._keySequence.length > this._targetSequence.length) {\r\n      this._keySequence.shift();\r\n    }\r\n\r\n    // Check if sequence matches\r\n    if (this.#checkSequence()) {\r\n      this._isActivated = true;\r\n      this.#notifyChange();\r\n      console.log(\"ðŸŽ® Secret dashboard unlocked!\");\r\n    }\r\n\r\n    // Reset sequence after 2 seconds of inactivity\r\n    this._timeoutId = window.setTimeout(() => {\r\n      this._keySequence = [];\r\n    }, 2000);\r\n  };\r\n\r\n  #checkSequence(): boolean {\r\n    if (this._keySequence.length !== this._targetSequence.length) {\r\n      return false;\r\n    }\r\n\r\n    return this._targetSequence.every(\r\n      (key, index) => key === this._keySequence[index]\r\n    );\r\n  }\r\n\r\n  #notifyChange() {\r\n    // Dispatch a custom event to notify condition checkers\r\n    window.dispatchEvent(new CustomEvent(\"key-sequence-activated\"));\r\n  }\r\n\r\n  isActivated(): boolean {\r\n    return this._isActivated;\r\n  }\r\n\r\n  override destroy(): void {\r\n    super.destroy();\r\n    document.removeEventListener(\"keydown\", this.#handleKeyPress);\r\n    if (this._timeoutId) {\r\n      window.clearTimeout(this._timeoutId);\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet instance: KeySequenceService | null = null;\r\n\r\nexport function getKeySequenceService(host: UmbControllerHost): KeySequenceService {\r\n  if (!instance) {\r\n    instance = new KeySequenceService(host);\r\n  }\r\n  return instance;\r\n}\r\n","import {\r\n  type UmbConditionConfigBase,\r\n  type UmbConditionControllerArguments,\r\n  type UmbExtensionCondition,\r\n} from \"@umbraco-cms/backoffice/extension-api\";\r\nimport { UmbConditionBase } from \"@umbraco-cms/backoffice/extension-registry\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { getKeySequenceService } from \"./key-sequence.service.js\";\r\n\r\nexport type KeySequenceConditionConfig = UmbConditionConfigBase<\"OC.Condition.KeySequence\">;\r\n\r\nexport class KeySequenceCondition\r\n  extends UmbConditionBase<KeySequenceConditionConfig>\r\n  implements UmbExtensionCondition\r\n{\r\n  #handleActivation: () => void;\r\n\r\n  constructor(\r\n    host: UmbControllerHost,\r\n    args: UmbConditionControllerArguments<KeySequenceConditionConfig>\r\n  ) {\r\n    super(host, args);\r\n\r\n    // Initialize the service\r\n    const service = getKeySequenceService(host);\r\n    \r\n    // Set initial state\r\n    this.permitted = service.isActivated();\r\n\r\n    // Listen for activation events\r\n    this.#handleActivation = () => {\r\n      this.permitted = service.isActivated();\r\n    };\r\n\r\n    window.addEventListener(\"key-sequence-activated\", this.#handleActivation);\r\n  }\r\n\r\n  override destroy(): void {\r\n    window.removeEventListener(\"key-sequence-activated\", this.#handleActivation);\r\n    super.destroy();\r\n  }\r\n}\r\n\r\nexport default KeySequenceCondition;\r\n"],"names":["KeySequenceService","UmbControllerBase","host","#handleKeyPress","event","#checkSequence","#notifyChange","#setupKeyListener","key","index","instance","getKeySequenceService","KeySequenceCondition","UmbConditionBase","#handleActivation","args","service"],"mappings":";;AAGO,MAAMA,UAA2BC,EAAkB;AAAA,EAMxD,YAAYC,GAAyB;AACnC,UAAMA,CAAI,GANZ,KAAQ,eAAyB,CAAA,GACjC,KAAQ,kBAAkB,CAAC,WAAW,WAAW,aAAa,aAAa,aAAa,YAAY,GACpG,KAAQ,eAAe,IAYvB,KAAAC,KAAkB,CAACC,MAAyB;AAE1C,MAAI,KAAK,cACP,OAAO,aAAa,KAAK,UAAU,GAIrC,KAAK,aAAa,KAAKA,EAAM,GAAG,GAG5B,KAAK,aAAa,SAAS,KAAK,gBAAgB,UAClD,KAAK,aAAa,MAAA,GAIhB,KAAKC,SACP,KAAK,eAAe,IACpB,KAAKC,GAAA,GACL,QAAQ,IAAI,+BAA+B,IAI7C,KAAK,aAAa,OAAO,WAAW,MAAM;AACxC,aAAK,eAAe,CAAA;AAAA,MACtB,GAAG,GAAI;AAAA,IACT,GAhCE,KAAKC,GAAA;AAAA,EACP;AAAA,EAEAA,KAAoB;AAClB,aAAS,iBAAiB,WAAW,KAAKJ,EAAe;AAAA,EAC3D;AAAA,EAEAA;AAAA,EA2BAE,KAA0B;AACxB,WAAI,KAAK,aAAa,WAAW,KAAK,gBAAgB,SAC7C,KAGF,KAAK,gBAAgB;AAAA,MAC1B,CAACG,GAAKC,MAAUD,MAAQ,KAAK,aAAaC,CAAK;AAAA,IAAA;AAAA,EAEnD;AAAA,EAEAH,KAAgB;AAEd,WAAO,cAAc,IAAI,YAAY,wBAAwB,CAAC;AAAA,EAChE;AAAA,EAEA,cAAuB;AACrB,WAAO,KAAK;AAAA,EACd;AAAA,EAES,UAAgB;AACvB,UAAM,QAAA,GACN,SAAS,oBAAoB,WAAW,KAAKH,EAAe,GACxD,KAAK,cACP,OAAO,aAAa,KAAK,UAAU;AAAA,EAEvC;AACF;AAGA,IAAIO,IAAsC;AAEnC,SAASC,EAAsBT,GAA6C;AACjF,SAAKQ,MACHA,IAAW,IAAIV,EAAmBE,CAAI,IAEjCQ;AACT;ACtEO,MAAME,UACHC,EAEV;AAAA,EACEC;AAAA,EAEA,YACEZ,GACAa,GACA;AACA,UAAMb,GAAMa,CAAI;AAGhB,UAAMC,IAAUL,EAAsBT,CAAI;AAG1C,SAAK,YAAYc,EAAQ,YAAA,GAGzB,KAAKF,KAAoB,MAAM;AAC7B,WAAK,YAAYE,EAAQ,YAAA;AAAA,IAC3B,GAEA,OAAO,iBAAiB,0BAA0B,KAAKF,EAAiB;AAAA,EAC1E;AAAA,EAES,UAAgB;AACvB,WAAO,oBAAoB,0BAA0B,KAAKA,EAAiB,GAC3E,MAAM,QAAA;AAAA,EACR;AACF;"}