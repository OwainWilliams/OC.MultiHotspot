{"version":3,"file":"property-editor-multi-hotspot-editor.element-71ml8vA7.js","sources":["../../../Client/src/multihotspotEditor/property-editor-multi-hotspot-editor.element.ts"],"sourcesContent":["import { customElement, html, property, state, css, unsafeHTML } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport type { HotSpotsEditorValues, HotSpotsEditorHotspot } from \"../types/HotSpotseditor\";\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT, UmbDocumentWorkspaceContext } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbDocumentDetailRepository } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbDocumentItemRepository } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbMediaDetailRepository } from \"@umbraco-cms/backoffice/media\";\r\nimport { UmbEntityUnique } from \"@umbraco-cms/backoffice/entity\";\r\nimport { UmbElementDetailModel } from \"@umbraco-cms/backoffice/content\";\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport type { UmbInputTiptapElement } from '@umbraco-cms/backoffice/tiptap';\r\n\r\n/* \r\n    The original code was from https://github.com/skttl/umbraco-image-hotspot/tree/main/src \r\n    Modified for Umbraco 17 and customised to allow for multiple hotspots and text descriptions with titles.\r\n*/\r\n\r\n// Constants\r\nconst DEFAULT_IMAGE_WIDTH = 400;\r\nconst DEFAULT_ASPECT_RATIO = 0.75;\r\nconst HOTSPOT_COORDINATE_PRECISION = 6;\r\nconst MAX_TITLE_LENGTH = 200;\r\nconst MAX_DESCRIPTION_LENGTH = 2000;\r\nconst MIN_IMAGE_WIDTH = 100;\r\nconst MAX_IMAGE_WIDTH = 2000;\r\n\r\nconst DEFAULT_MAP_BOUNDS = {\r\n    north: 100,\r\n    south: 0,\r\n    east: 100,\r\n    west: 0\r\n} as const;\r\n\r\n// Enums\r\nenum Theme {\r\n    Red = 1,\r\n    Green = 2,\r\n    Blue = 3,\r\n    Orange = 4\r\n}\r\n\r\nconst THEME_MAPPING = {\r\n    Red: Theme.Red,\r\n    Green: Theme.Green,\r\n    Blue: Theme.Blue,\r\n    Orange: Theme.Orange\r\n} as const;\r\n\r\n// Type definitions\r\ninterface ImageBounds {\r\n    north: number;\r\n    south: number;\r\n    east: number;\r\n    west: number;\r\n}\r\n\r\ninterface PixelCoordinate {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\ninterface LatLngCoordinate {\r\n    lat: number;\r\n    lng: number;\r\n}\r\n\r\n/**\r\n * Custom Map Editor Element for Umbraco\r\n * Allows users to place interactive hotspots on map images with lat/lng coordinates.\r\n * Supports multiple hotspots with rich text descriptions and titles.\r\n */\r\n@customElement('property-editor-multi-hotspot-editor')\r\nexport class PropertyEditorHotSpotsEditorElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n    \r\n    private _configCollection = new UmbPropertyEditorConfigCollection([\r\n        {\r\n            alias: 'hideLabel',\r\n            value: true,\r\n        },\r\n        { alias: 'dimensions', value: { height: 300 } },\r\n        { alias: 'maxImageSize', value: 500 },\r\n        { alias: 'ignoreUserStartNodes', value: false },\r\n        {\r\n            alias: 'toolbar',\r\n            value: [\r\n                [\r\n                    ['Umb.Tiptap.Toolbar.SourceEditor'],\r\n                    ['Umb.Tiptap.Toolbar.Bold', 'Umb.Tiptap.Toolbar.Italic', 'Umb.Tiptap.Toolbar.Underline'],\r\n                    ['Umb.Tiptap.Toolbar.TextAlignLeft', 'Umb.Tiptap.Toolbar.TextAlignCenter', 'Umb.Tiptap.Toolbar.TextAlignRight'],\r\n                    ['Umb.Tiptap.Toolbar.BulletList', 'Umb.Tiptap.Toolbar.OrderedList'],\r\n                    ['Umb.Tiptap.Toolbar.Blockquote', 'Umb.Tiptap.Toolbar.HorizontalRule'],\r\n                    ['Umb.Tiptap.Toolbar.Link', 'Umb.Tiptap.Toolbar.Unlink'],\r\n                    ['Umb.Tiptap.Toolbar.MediaPicker', 'Umb.Tiptap.Toolbar.EmbeddedMedia'],\r\n                ],\r\n            ],\r\n        },\r\n        {\r\n            alias: 'extensions',\r\n            value: [\r\n                'Umb.Tiptap.RichTextEssentials', 'Umb.Tiptap.Blockquote', 'Umb.Tiptap.Bold', 'Umb.Tiptap.BulletList', 'Umb.Tiptap.Embed', 'Umb.Tiptap.Figure', 'Umb.Tiptap.HorizontalRule', 'Umb.Tiptap.Image', 'Umb.Tiptap.Italic', 'Umb.Tiptap.Link', 'Umb.Tiptap.MediaUpload', 'Umb.Tiptap.OrderedList', 'Umb.Tiptap.Subscript', 'Umb.Tiptap.Superscript', 'Umb.Tiptap.TextAlign', 'Umb.Tiptap.Underline',\r\n            ],\r\n        },\r\n    ]);\r\n\r\n    @state()\r\n    private _config?: UmbPropertyEditorConfigCollection;\r\n\r\n    @state()\r\n    private _imgSrc?: string;\r\n\r\n    @state()\r\n    private _imgWidth: number = DEFAULT_IMAGE_WIDTH;\r\n\r\n    @state()\r\n    private _imgHeight: number = 0;\r\n\r\n    @state()\r\n    private _imgTheme: Theme = Theme.Red;\r\n\r\n    @state()\r\n    private _selectedHotspot?: string;\r\n\r\n    @state()\r\n    private _isAddingHotspot: boolean = false;\r\n\r\n    @state()\r\n    private _mapBounds: ImageBounds = { ...DEFAULT_MAP_BOUNDS };\r\n\r\n    @state()\r\n    private _editingHotspot?: HotSpotsEditorHotspot;\r\n\r\n    @state()\r\n    private _hasUnsavedChanges: boolean = false;\r\n\r\n    @property({ attribute: false })\r\n    public set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n        this._config = config;\r\n        this.#setConfig();\r\n    }\r\n\r\n    public get config(): UmbPropertyEditorConfigCollection | undefined {\r\n        return this._config;\r\n    }\r\n\r\n    private _value: HotSpotsEditorValues = {\r\n        image: null,\r\n        width: null,\r\n        height: null,\r\n        bounds: null,\r\n        hotspots: []\r\n    };\r\n\r\n    @property({ attribute: false })\r\n    public set value(val: HotSpotsEditorValues | undefined | null) {\r\n        // Ensure we always have a valid value with proper defaults\r\n        this._value = this.#normalizeValue(val);\r\n        this.requestUpdate();\r\n    }\r\n\r\n    public get value(): HotSpotsEditorValues {\r\n        return this._value;\r\n    }\r\n\r\n    /**\r\n     * Normalizes incoming value to ensure it has all required properties\r\n     */\r\n    #normalizeValue(val: HotSpotsEditorValues | undefined | null): HotSpotsEditorValues {\r\n        if (!val || typeof val !== 'object') {\r\n            return {\r\n                image: null,\r\n                width: null,\r\n                height: null,\r\n                bounds: null,\r\n                hotspots: []\r\n            };\r\n        }\r\n\r\n        return {\r\n            image: val.image || null,\r\n            width: val.width || null,\r\n            height: val.height || null,\r\n            bounds: val.bounds || null,\r\n            hotspots: Array.isArray(val.hotspots) ? val.hotspots : []\r\n        };\r\n    }\r\n\r\n    #documentWorkspaceContext?: UmbDocumentWorkspaceContext;\r\n    #documentDetailRepository = new UmbDocumentDetailRepository(this);\r\n    #documentItemRepository = new UmbDocumentItemRepository(this);\r\n    #mediaDetailRepository = new UmbMediaDetailRepository(this);\r\n\r\n    // Coordinate conversion utilities\r\n    private readonly coordinateConverter = {\r\n        /**\r\n         * Converts pixel coordinates to geographic coordinates based on configured map bounds\r\n         * @param x - Pixel X coordinate\r\n         * @param y - Pixel Y coordinate  \r\n         * @returns Geographic coordinates\r\n         * @throws Error if image dimensions are invalid\r\n         */\r\n        pixelToLatLng: (x: number, y: number): LatLngCoordinate => {\r\n            if (!this.#validateImageDimensions()) {\r\n                throw new Error('Invalid image dimensions for coordinate conversion');\r\n            }\r\n            \r\n            const lat = this._mapBounds.north - \r\n                ((y / this._imgHeight) * (this._mapBounds.north - this._mapBounds.south));\r\n            const lng = this._mapBounds.west + \r\n                ((x / this._imgWidth) * (this._mapBounds.east - this._mapBounds.west));\r\n            \r\n            return { lat, lng };\r\n        },\r\n\r\n        /**\r\n         * Converts geographic coordinates to pixel coordinates for display\r\n         * @param lat - Latitude\r\n         * @param lng - Longitude\r\n         * @returns Pixel coordinates\r\n         * @throws Error if image dimensions are invalid\r\n         */\r\n        latLngToPixel: (lat: number, lng: number): PixelCoordinate => {\r\n            if (!this.#validateImageDimensions()) {\r\n                throw new Error('Invalid image dimensions for coordinate conversion');\r\n            }\r\n            \r\n            const y = ((this._mapBounds.north - lat) / \r\n                (this._mapBounds.north - this._mapBounds.south)) * this._imgHeight;\r\n            const x = ((lng - this._mapBounds.west) / \r\n                (this._mapBounds.east - this._mapBounds.west)) * this._imgWidth;\r\n            \r\n            return { x, y };\r\n        }\r\n    };\r\n  \r\n    // Event handlers organized for better maintainability\r\n    private readonly eventHandlers = {\r\n        /**\r\n         * Handles clicks on the image area for adding new hotspots\r\n         */\r\n        imageClick: (event: MouseEvent): void => {\r\n            if (this._isAddingHotspot) {\r\n                this.#addHotspotAtPosition(event.offsetX, event.offsetY);\r\n                this._isAddingHotspot = false;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Handles clicks on hotspot markers\r\n         */\r\n        hotspotClick: (event: MouseEvent, hotspotId: string): void => {\r\n            event.stopPropagation();\r\n            this.#selectHotspot(hotspotId);\r\n        },\r\n\r\n        /**\r\n         * Handles drag end events for hotspot repositioning\r\n         */\r\n        hotspotDragEnd: (event: DragEvent, hotspotId: string): void => {\r\n            const position = this.#getMousePositionFromDragEvent(event);\r\n            if (position) {\r\n                this.#moveHotspotToPosition(hotspotId, position);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Handles title input changes - updates editing state only\r\n         */\r\n        titleInput: (event: Event): void => {\r\n            const target = event.target as HTMLInputElement;\r\n            const sanitizedTitle = this.#sanitizeInput(target.value, MAX_TITLE_LENGTH);\r\n\r\n            if (!this._selectedHotspot) return;\r\n            \r\n            // Update editing state instead of main value\r\n            this._editingHotspot = {\r\n                ...this._editingHotspot!,\r\n                title: sanitizedTitle\r\n            };\r\n            this._hasUnsavedChanges = true;\r\n            this.requestUpdate();\r\n        },\r\n\r\n        /**\r\n         * Handles rich text editor changes for descriptions - updates editing state only\r\n         */\r\n        descriptionChange: (event: CustomEvent & { target: UmbInputTiptapElement }): void => {\r\n            if (this._selectedHotspot && this._editingHotspot) {\r\n                const markup = event.target.value;\r\n                const sanitizedMarkup = this.#sanitizeInput(markup || '', MAX_DESCRIPTION_LENGTH);\r\n                \r\n                // Update editing state instead of main value\r\n                this._editingHotspot = {\r\n                    ...this._editingHotspot,\r\n                    description: sanitizedMarkup\r\n                };\r\n                this._hasUnsavedChanges = true;\r\n                this.requestUpdate();\r\n            }\r\n        }\r\n    };\r\n\r\n    // Consolidated state update methods\r\n    /**\r\n     * Updates the value and notifies of changes in a single operation\r\n     */\r\n    #updateValueAndNotify(updates: Partial<HotSpotsEditorValues>): void {\r\n        this.value = { ...this.value, ...updates };\r\n        this.dispatchEvent(new UmbChangeEvent());\r\n        this.requestUpdate();\r\n    }\r\n\r\n   \r\n    /**\r\n     * Selects or deselects a hotspot and initializes editing state\r\n     */\r\n    #selectHotspot(hotspotId: string): void {\r\n        // Save any pending changes before switching hotspots\r\n        if (this._hasUnsavedChanges && this._editingHotspot) {\r\n            this.#saveHotspotChanges();\r\n        }\r\n\r\n        if (this._selectedHotspot === hotspotId) {\r\n            // Deselecting\r\n            this._selectedHotspot = undefined;\r\n            this._editingHotspot = undefined;\r\n        } else {\r\n            // Selecting new hotspot\r\n            this._selectedHotspot = hotspotId;\r\n            const hotspot = this.value.hotspots.find((h: HotSpotsEditorHotspot) => h.id === hotspotId);\r\n            if (hotspot) {\r\n                // Create a copy for editing\r\n                this._editingHotspot = { ...hotspot };\r\n            }\r\n        }\r\n        \r\n        this._hasUnsavedChanges = false;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    /**\r\n     * Saves changes from editing state to main value\r\n     */\r\n    #saveHotspotChanges(): void {\r\n        if (!this._editingHotspot || !this._selectedHotspot) return;\r\n\r\n        const updatedHotspots = this.value.hotspots.map((hotspot: HotSpotsEditorHotspot) =>\r\n            hotspot.id === this._selectedHotspot ? { ...this._editingHotspot! } : hotspot\r\n        );\r\n\r\n        this.#updateValueAndNotify({ hotspots: updatedHotspots });\r\n        this._hasUnsavedChanges = false;\r\n    }\r\n\r\n    /**\r\n     * Adds a hotspot at the specified position\r\n     */\r\n    #addHotspotAtPosition(x: number, y: number): void {\r\n        if (!this.#validateImageDimensions()) {\r\n            console.warn('Cannot add hotspot: invalid image dimensions');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Ensure we have a valid value before proceeding\r\n            if (!this.value || !Array.isArray(this.value.hotspots)) {\r\n                console.error('Cannot add hotspot: value or hotspots array is invalid');\r\n                return;\r\n            }\r\n\r\n            const id = this.#generateHotspotId();\r\n            const { lat, lng } = this.coordinateConverter.pixelToLatLng(x, y);\r\n\r\n            const newHotspot: HotSpotsEditorHotspot = {\r\n                id,\r\n                lat,\r\n                lng,\r\n                description: '',\r\n                title: ''\r\n            };\r\n\r\n            const updatedValue: HotSpotsEditorValues = {\r\n                ...this.value,\r\n                width: this._imgWidth,\r\n                height: this._imgHeight,\r\n                image: this._imgSrc || null,\r\n                bounds: this._mapBounds,\r\n                hotspots: [...this.value.hotspots, newHotspot]\r\n            };\r\n\r\n            this.value = updatedValue;\r\n            this._selectedHotspot = id;\r\n            this._editingHotspot = { ...newHotspot };\r\n            this._hasUnsavedChanges = false;\r\n            this.dispatchEvent(new UmbChangeEvent());\r\n            this.requestUpdate();\r\n        } catch (error) {\r\n            console.error('Failed to add hotspot:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Moves a hotspot to a new position\r\n     */\r\n    #moveHotspotToPosition(hotspotId: string, position: PixelCoordinate): void {\r\n        if (!this.#validateImageDimensions()) {\r\n            console.warn('Cannot move hotspot: invalid image dimensions');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const { lat, lng } = this.coordinateConverter.pixelToLatLng(position.x, position.y);\r\n            \r\n            // If the moved hotspot is not currently selected, select it first\r\n            if (this._selectedHotspot !== hotspotId) {\r\n                // Save any existing unsaved changes first\r\n                if (this._hasUnsavedChanges && this._editingHotspot) {\r\n                    this.#saveHotspotChanges();\r\n                }\r\n                \r\n                // Select the moved hotspot\r\n                this._selectedHotspot = hotspotId;\r\n                const hotspot = this.value.hotspots.find((h: HotSpotsEditorHotspot) => h.id === hotspotId);\r\n                if (hotspot) {\r\n                    this._editingHotspot = { ...hotspot };\r\n                }\r\n            }\r\n            \r\n            // Update the editing state with new coordinates\r\n            if (this._editingHotspot) {\r\n                this._editingHotspot = {\r\n                    ...this._editingHotspot,\r\n                    lat,\r\n                    lng\r\n                };\r\n                this._hasUnsavedChanges = true;\r\n                this.requestUpdate();\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to move hotspot:', error);\r\n        }\r\n    }\r\n\r\n    // Validation methods\r\n    /**\r\n     * Validates if image dimensions are valid for coordinate operations\r\n     */\r\n    #validateImageDimensions(): boolean {\r\n        return this._imgWidth > 0 && this._imgHeight > 0;\r\n    }\r\n\r\n    /**\r\n     * Validates if hotspot coordinates are valid numbers\r\n     */\r\n    #validateHotspotCoordinates(hotspot: HotSpotsEditorHotspot): boolean {\r\n        return typeof hotspot.lat === 'number' && \r\n               typeof hotspot.lng === 'number' && \r\n               !isNaN(hotspot.lat) && \r\n               !isNaN(hotspot.lng);\r\n    }\r\n\r\n    /**\r\n     * Validates and clamps configured width to reasonable bounds\r\n     */\r\n    #validateConfiguredWidth(configuredWidth: string | undefined): number {\r\n        const width = configuredWidth ? parseInt(configuredWidth, 10) : DEFAULT_IMAGE_WIDTH;\r\n        return Math.max(MIN_IMAGE_WIDTH, Math.min(MAX_IMAGE_WIDTH, width));\r\n    }\r\n\r\n    // Utility methods\r\n    /**\r\n     * Generates a unique ID for hotspots\r\n     */\r\n    #generateHotspotId(): string {\r\n        return `hotspot_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Sanitizes input to prevent excessive length and harmful content\r\n     */\r\n    #sanitizeInput(input: string, maxLength: number): string {\r\n        return input.trim().substring(0, maxLength);\r\n    }\r\n\r\n    /**\r\n     * Gets mouse position from drag event relative to image container\r\n     */\r\n    #getMousePositionFromDragEvent(event: DragEvent): PixelCoordinate | null {\r\n        if (event.dataTransfer && event.target instanceof HTMLElement) {\r\n            const imageContainer = event.target.closest('.imagehotspot-image') as HTMLElement;\r\n            if (imageContainer) {\r\n                const rect = imageContainer.getBoundingClientRect();\r\n                return {\r\n                    x: event.clientX - rect.left,\r\n                    y: event.clientY - rect.top\r\n                };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Generates tooltip text for hotspots\r\n     */\r\n    #getHotspotTooltip(hotspot: HotSpotsEditorHotspot, number: number): string {\r\n        if (hotspot.title) {\r\n            const description = hotspot.description ? `: ${hotspot.description}` : '';\r\n            return `${hotspot.title}${description}`;\r\n        }\r\n        return hotspot.description || `Hotspot ${number}`;\r\n    }\r\n\r\n    /**\r\n     * Removes a specific hotspot\r\n     */\r\n    #removeHotspot(hotspotId: string): void {\r\n        const filteredHotspots = this.value.hotspots.filter((h: HotSpotsEditorHotspot) => h.id !== hotspotId);\r\n        \r\n        this.#updateValueAndNotify({ hotspots: filteredHotspots });\r\n\r\n        if (this._selectedHotspot === hotspotId) {\r\n            this._selectedHotspot = undefined;\r\n            this._editingHotspot = undefined;\r\n            this._hasUnsavedChanges = false;\r\n        }\r\n    }\r\n    /**\r\n     * Removes all hotspots with confirmation\r\n     */\r\n    #removeAllHotspots = (): void => {\r\n        const hotspotsCount = this.value.hotspots.length;\r\n\r\n        if (hotspotsCount === 0) {\r\n            return;\r\n        }\r\n\r\n        const confirmed = confirm(\r\n            `Are you sure you want to delete all ${hotspotsCount} hotspot${hotspotsCount > 1 ? 's' : ''}? This action cannot be undone.`\r\n        );\r\n\r\n        if (confirmed) {\r\n            this.#updateValueAndNotify({ hotspots: [] });\r\n            this._selectedHotspot = undefined;\r\n            this._editingHotspot = undefined;\r\n            this._hasUnsavedChanges = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggles hotspot addition mode\r\n     */\r\n    #toggleAddMode = (): void => {\r\n        // Save any pending changes before toggling add mode\r\n        if (this._hasUnsavedChanges && this._editingHotspot) {\r\n            this.#saveHotspotChanges();\r\n        }\r\n\r\n        this._isAddingHotspot = !this._isAddingHotspot;\r\n        this._selectedHotspot = undefined;\r\n        this._editingHotspot = undefined;\r\n        this._hasUnsavedChanges = false;\r\n        this.requestUpdate();\r\n    }\r\n\r\n    // Configuration and image handling methods\r\n    /**\r\n     * Main configuration setup method with improved error handling\r\n     */\r\n    async #setConfig(): Promise<void> {\r\n        try {\r\n            if (!this._config || !this.#documentWorkspaceContext) {\r\n                return;\r\n            }\r\n\r\n            const imagePropertyAlias = this._config.getValueByAlias(\"imageSrc\")?.toString();\r\n            if (!imagePropertyAlias) {\r\n                console.warn('No imageSrc property configured for custom map editor');\r\n                this.#setPlaceholderImage();\r\n                return;\r\n            }\r\n\r\n            await this.#configureImageFromProperty(imagePropertyAlias);\r\n            this.#configureTheme();\r\n            this.requestUpdate();\r\n            \r\n        } catch (error) {\r\n            console.error('Failed to configure custom map editor:', error);\r\n            this.#setPlaceholderImage();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configures image from property with error handling\r\n     */\r\n    async #configureImageFromProperty(imagePropertyAlias: string): Promise<void> {\r\n        let imageValue = this.#documentWorkspaceContext?.getPropertyValue<Array<any>>(imagePropertyAlias);\r\n\r\n        if (!imageValue) {\r\n            const retrievedValue = await this.#getValueFromUnique(\r\n                this.#documentWorkspaceContext?.getUnique(), \r\n                imagePropertyAlias\r\n            );\r\n            imageValue = retrievedValue || undefined;\r\n        }\r\n\r\n        if (imageValue && typeof imageValue === 'object') {\r\n            const firstImageValue = Array.isArray(imageValue) ? imageValue[0] : imageValue;\r\n            const mediaKey = firstImageValue?.mediaKey || firstImageValue?.key || firstImageValue?.udi;\r\n\r\n            if (!mediaKey && firstImageValue?.src) {\r\n                this.#configureDirectImageSrc(firstImageValue.src);\r\n            } else if (mediaKey) {\r\n                await this.#configureMediaImage(mediaKey);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configures image from direct src\r\n     */\r\n    #configureDirectImageSrc(src: string): void {\r\n        const configuredWidth = this._config?.getValueByAlias(\"width\");\r\n        this._imgWidth = this.#validateConfiguredWidth(configuredWidth?.toString());\r\n        this._imgHeight = Math.round(this._imgWidth * DEFAULT_ASPECT_RATIO);\r\n        this._imgSrc = `${src}?width=${this._imgWidth}&height=${this._imgHeight}&rmode=min&quality=80`;\r\n    }\r\n\r\n    /**\r\n     * Configures image from media repository\r\n     */\r\n    async #configureMediaImage(mediaKey: string): Promise<void> {\r\n        try {\r\n            const media = await this.#mediaDetailRepository.requestByUnique(mediaKey);\r\n\r\n            if (media?.data) {\r\n                const mediaWidth = this.#getPropertyValue(\"umbracoWidth\", media.data) || 0;\r\n                const mediaHeight = this.#getPropertyValue(\"umbracoHeight\", media.data) || 0;\r\n\r\n                const configuredWidth = this._config?.getValueByAlias(\"width\");\r\n                this._imgWidth = this.#validateConfiguredWidth(configuredWidth?.toString());\r\n\r\n                if (mediaWidth > 0 && mediaHeight > 0) {\r\n                    this._imgHeight = Math.round(this._imgWidth * mediaHeight / mediaWidth);\r\n                } else {\r\n                    this._imgHeight = Math.round(this._imgWidth * DEFAULT_ASPECT_RATIO);\r\n                }\r\n\r\n                const umbracoFile = this.#getPropertyValue(\"umbracoFile\", media.data);\r\n\r\n                if (umbracoFile?.src) {\r\n                    this._imgSrc = `${umbracoFile.src}?width=${this._imgWidth}&height=${this._imgHeight}&rmode=min&quality=80`;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.warn('Failed to load media image:', error);\r\n            this.#setPlaceholderImage();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configures theme based on configuration\r\n     */\r\n    #configureTheme(): void {\r\n        const theme = this._config?.getValueByAlias(\"theme\") || \"Red\";\r\n        this._imgTheme = THEME_MAPPING[theme as keyof typeof THEME_MAPPING] || Theme.Red;\r\n    }\r\n\r\n    /**\r\n     * Sets placeholder image when configuration fails\r\n     */\r\n    #setPlaceholderImage(): void {\r\n        this._imgWidth = DEFAULT_IMAGE_WIDTH;\r\n        this._imgHeight = Math.round(this._imgWidth * DEFAULT_ASPECT_RATIO);\r\n        this._imgSrc = undefined;\r\n    }\r\n\r\n    // Helper methods for parent traversal and property access\r\n    /**\r\n     * Gets parent entity from unique identifier with error handling\r\n     */\r\n    async #getParentFromUnique(unique: string | undefined | null): Promise<UmbEntityUnique | undefined> {\r\n        if (!unique) {\r\n            return undefined;\r\n        }\r\n\r\n        try {\r\n            const parent = await this.#documentItemRepository.requestItems([unique]);\r\n            return parent?.data?.[0]?.parent?.unique;\r\n        } catch (error) {\r\n            console.warn('Failed to get parent from unique:', error);\r\n            return undefined;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Recursively gets property value from document hierarchy\r\n     */\r\n    async #getValueFromUnique(unique: UmbEntityUnique | undefined | null, alias: string): Promise<Array<any> | null> {\r\n        if (!unique) {\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            const item = await this.#documentDetailRepository.requestByUnique(unique);\r\n            const value = this.#getPropertyValue(alias, item?.data);\r\n            \r\n            if (value) {\r\n                return value as Array<any>;\r\n            }\r\n            \r\n            // Recursively check parent if not found\r\n            const parentUnique = await this.#getParentFromUnique(unique);\r\n            return await this.#getValueFromUnique(parentUnique, alias);\r\n        } catch (error) {\r\n            console.warn('Failed to get value from unique:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Safely extracts property value from element model\r\n     */\r\n    #getPropertyValue(alias: string, item: UmbElementDetailModel | undefined): any {\r\n        if (!item?.values) {\r\n            return null;\r\n        }\r\n\r\n        const property = item.values.find((prop) => prop.alias === alias);\r\n        return property?.value || null;\r\n    }\r\n\r\n    // Rendering helper methods\r\n    /**\r\n     * Renders hotspot markers with validation\r\n     */\r\n    #renderHotspotMarkers() {\r\n        // Add null check for this.value\r\n        if (!this.value?.hotspots) {\r\n            return [];\r\n        }\r\n        \r\n        const validHotspots = this.value.hotspots.filter(this.#validateHotspotCoordinates.bind(this));\r\n        \r\n        return validHotspots.map((hotspot: HotSpotsEditorHotspot, index: number) => {\r\n            try {\r\n                const { x, y } = this.coordinateConverter.latLngToPixel(hotspot.lat, hotspot.lng);\r\n                return this.#renderHotspotMarker(hotspot, index + 1, x, y);\r\n            } catch (error) {\r\n                console.warn('Failed to render hotspot marker:', error);\r\n                return html``;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Renders individual hotspot marker\r\n     */\r\n    #renderHotspotMarker(hotspot: HotSpotsEditorHotspot, number: number, x: number, y: number) {\r\n        const isSelected = this._selectedHotspot === hotspot.id;\r\n        const hasUnsavedPosition = isSelected && this._hasUnsavedChanges && this._editingHotspot && \r\n            (this._editingHotspot.lat !== hotspot.lat || this._editingHotspot.lng !== hotspot.lng);\r\n        \r\n        // Use editing coordinates if this hotspot is being edited and has moved\r\n        let displayX = x;\r\n        let displayY = y;\r\n        \r\n        if (hasUnsavedPosition && this._editingHotspot) {\r\n            try {\r\n                const editingPixel = this.coordinateConverter.latLngToPixel(\r\n                    this._editingHotspot.lat, \r\n                    this._editingHotspot.lng\r\n                );\r\n                displayX = editingPixel.x;\r\n                displayY = editingPixel.y;\r\n            } catch (error) {\r\n                console.warn('Failed to convert editing coordinates:', error);\r\n            }\r\n        }\r\n        \r\n        const title = this.#getHotspotTooltip(hotspot, number);\r\n        \r\n        return html`\r\n            <div \r\n                class=\"imagehotspot-hotspot ${isSelected ? 'selected' : ''} ${hasUnsavedPosition ? 'moved' : ''}\" \r\n                draggable=\"true\" \r\n                @dragend=\"${(e: DragEvent) => this.eventHandlers.hotspotDragEnd(e, hotspot.id)}\"\r\n                @click=\"${(e: MouseEvent) => this.eventHandlers.hotspotClick(e, hotspot.id)}\"\r\n                style=\"left:${displayX}px;top:${displayY}px;\"\r\n                title=\"${title}${hasUnsavedPosition ? ' (moved - unsaved)' : ''}\">\r\n                <span class=\"hotspot-number\">${number}</span>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders hotspot table rows with validation and error handling\r\n     */\r\n    #renderHotspotTableRows() {\r\n        // Add null check for this.value\r\n        if (!this.value?.hotspots) {\r\n            return [];\r\n        }\r\n        \r\n        return this.value.hotspots.map((hotspot: HotSpotsEditorHotspot, index: number) => {\r\n            const isSelected = this._selectedHotspot === hotspot.id;\r\n            \r\n            if (!this.#validateHotspotCoordinates(hotspot)) {\r\n                return this.#renderInvalidHotspotRow(hotspot, index, isSelected);\r\n            }\r\n\r\n            return this.#renderValidHotspotRow(hotspot, index, isSelected);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Renders table row for invalid hotspot coordinates\r\n     */\r\n    #renderInvalidHotspotRow(hotspot: HotSpotsEditorHotspot, index: number, isSelected: boolean) {\r\n        return html`\r\n            <tr class=\"${isSelected ? 'selected-row' : ''}\">\r\n                <td class=\"hotspot-index\">${index + 1}</td>\r\n                <td class=\"hotspot-description\">\r\n                    ${hotspot.description || '<em>No description</em>'}\r\n                </td>\r\n                <td class=\"hotspot-coordinates\">\r\n                    <em>Invalid coordinates</em>\r\n                </td>\r\n                <td class=\"hotspot-coordinates\">\r\n                    <em>Invalid coordinates</em>\r\n                </td>\r\n                <td class=\"hotspot-actions\">\r\n                    <button \r\n                        type=\"button\" \r\n                        class=\"imagehotspot-btn-small imagehotspot-btn-danger\" \r\n                        @click=\"${() => this.#removeHotspot(hotspot.id)}\"\r\n                        title=\"Delete this hotspot\">\r\n                        Delete\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders table row for valid hotspot\r\n     */\r\n    #renderValidHotspotRow(hotspot: HotSpotsEditorHotspot, index: number, isSelected: boolean) {\r\n        const selectHotspot = () => {\r\n            this.#selectHotspot(hotspot.id);\r\n        };\r\n\r\n        const deleteHotspot = (e: Event) => {\r\n            e.stopPropagation();\r\n            this.#removeHotspot(hotspot.id);\r\n        };\r\n\r\n        return html`\r\n            <tr class=\"${isSelected ? 'selected-row' : ''}\"\r\n                @click=\"${selectHotspot}\"\r\n                style=\"cursor: pointer;\">\r\n                <td class=\"hotspot-index\">${index + 1}</td>\r\n                <td class=\"hotspot-description\">\r\n                    ${hotspot.title \r\n                        ? html`<strong>${hotspot.title}</strong><br/>${unsafeHTML(hotspot.description) || '<em>No description</em>'}` \r\n                        : unsafeHTML(hotspot.description) || '<em>No description</em>'}\r\n                </td>\r\n                <td class=\"hotspot-coordinates\">\r\n                    ${hotspot.lat.toFixed(HOTSPOT_COORDINATE_PRECISION)}\r\n                </td>\r\n                <td class=\"hotspot-coordinates\">\r\n                    ${hotspot.lng.toFixed(HOTSPOT_COORDINATE_PRECISION)}\r\n                </td>\r\n                <td class=\"hotspot-actions\">\r\n                    <button \r\n                        type=\"button\" \r\n                        class=\"imagehotspot-btn-small imagehotspot-btn-danger\" \r\n                        @click=\"${deleteHotspot}\"\r\n                        title=\"Delete this hotspot\">\r\n                        Delete\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n    }\r\n\r\n    // Lifecycle methods\r\n    /**\r\n     * Component connection lifecycle method\r\n     * Sets up document workspace context and initial configuration\r\n     */\r\n    connectedCallback(): void {\r\n        super.connectedCallback();\r\n\r\n        this.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (context) => {\r\n            this.#documentWorkspaceContext = context;\r\n            this.#setConfig();\r\n        });\r\n\r\n        // Also try to set config immediately if we already have it\r\n        if (this._config) {\r\n            this.#setConfig();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Component disconnection lifecycle method - saves any pending changes\r\n     */\r\n    disconnectedCallback(): void {\r\n        // Save any unsaved changes before component is destroyed\r\n        if (this._hasUnsavedChanges && this._editingHotspot) {\r\n            this.#saveHotspotChanges();\r\n        }\r\n        super.disconnectedCallback();\r\n    }\r\n\r\n    /**\r\n     * Constructor - initializes the element\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * Main render method - orchestrates the rendering of all UI components\r\n     * @returns Lit template result for the custom map editor\r\n     */\r\n    render() {\r\n        // Ensure hotspots array exists before rendering\r\n        const hotspots = this.value?.hotspots || [];\r\n\r\n        return html`\r\n      <div class=\"imagehotspot-editor theme${this._imgTheme}\">\r\n        <div class=\"imagehotspot-controls\">\r\n          <div class=\"controls-left\">\r\n            <button \r\n              type=\"button\" \r\n              class=\"imagehotspot-btn ${this._isAddingHotspot ? 'active' : ''}\" \r\n              @click=\"${this.#toggleAddMode}\">\r\n              ${this._isAddingHotspot ? 'Cancel Adding' : 'Add Hotspot'}\r\n            </button>\r\n            ${hotspots.length > 0 ? html`\r\n              <button \r\n                type=\"button\" \r\n                class=\"imagehotspot-btn-danger\" \r\n                @click=\"${this.#removeAllHotspots}\"\r\n                title=\"Delete all hotspots\">\r\n                Delete All\r\n              </button>\r\n            ` : ''}\r\n          </div>\r\n          <span class=\"imagehotspot-count\">${hotspots.length} hotspot${hotspots.length !== 1 ? 's' : ''}</span>\r\n        </div>\r\n\r\n        <div class=\"imagehotspot-image ${this._isAddingHotspot ? 'adding-mode' : ''}\" @click=\"${this.eventHandlers.imageClick}\">\r\n          ${this._imgSrc\r\n                ? html`\r\n              <img src=\"${this._imgSrc}\" width=\"${this._imgWidth}\" height=\"${this._imgHeight}\" style=\"display: block;\" />\r\n            `\r\n                : html`\r\n              <div class=\"imagehotspot-placeholder-image\">\r\n                <div style=\"padding: 20px; text-align: center; color: #666;\">\r\n                  No image configured<br/>\r\n                  <small>Check the imageSrc property configuration</small>\r\n                </div>\r\n              </div>\r\n            `\r\n            }\r\n\r\n           ${this.#renderHotspotMarkers()}\r\n        </div>\r\n\r\n        ${this._selectedHotspot ? html`\r\n          <div class=\"imagehotspot-panel\">\r\n            <div class=\"panel-content\">\r\n              <div style=\"margin-bottom: 16px;\">\r\n                <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Hotspot Title</label>\r\n                <p style=\"font-size: 12px; color: #666; margin-bottom: 8px;\">Optional title shown above the description</p>\r\n                <input \r\n                  type=\"text\" \r\n                  .value=${this._editingHotspot?.title || ''}\r\n                  @input=${this.eventHandlers.titleInput}\r\n                  placeholder=\"Enter hotspot title\"\r\n                  style=\"width: 100%; padding: 8px; border: 1px solid #d8d7d9; border-radius: 3px; font-size: 13px;\"\r\n                  maxlength=\"${MAX_TITLE_LENGTH}\">\r\n              </div>\r\n         \r\n              <div style=\"margin-bottom: 16px;\">\r\n                <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Hotspot Details</label>\r\n                <p style=\"font-size: 12px; color: #666; margin-bottom: 8px;\">Details about this specific hotspot</p>\r\n        \r\n                <umb-input-tiptap\r\n                    .configuration=${this._configCollection}\r\n                    .value=${this._editingHotspot?.description || ''}\r\n                    @change=${this.eventHandlers.descriptionChange}>\r\n                 </umb-input-tiptap>\r\n              </div>\r\n\r\n              ${this._hasUnsavedChanges ? html`\r\n                <div style=\"margin-bottom: 16px;\">\r\n                  <button \r\n                    type=\"button\" \r\n                    class=\"imagehotspot-btn\" \r\n                    @click=\"${() => this.#saveHotspotChanges()}\">\r\n                    Save Changes\r\n                  </button>\r\n                  <span style=\"margin-left: 8px; font-size: 12px; color: #666;\">\r\n                    You have unsaved changes${this._editingHotspot && this.value.hotspots.find((h: HotSpotsEditorHotspot) => h.id === this._selectedHotspot) && \r\n        (this._editingHotspot.lat !== this.value.hotspots.find((h: HotSpotsEditorHotspot) => h.id === this._selectedHotspot)?.lat || \r\n         this._editingHotspot.lng !== this.value.hotspots.find((h: HotSpotsEditorHotspot) => h.id === this._selectedHotspot)?.lng) \r\n        ? ' (includes position changes)' : ''}\r\n                  </span>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n\r\n        ${hotspots.length > 0 ? html`\r\n          <div class=\"hotspots-table-container\">\r\n            <h4>Hotspots Summary</h4>\r\n            <table class=\"hotspots-table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>#</th>\r\n                  <th>Title and Details</th>\r\n                  <th>Latitude</th>\r\n                  <th>Longitude</th>\r\n                  <th>Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                ${this.#renderHotspotTableRows()}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n    }\r\n    static override styles = [\r\n        UmbTextStyles,\r\n        css`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-editor {\r\n\t\t\t  border: 1px solid #d8d7d9;\r\n\t\t\t  background: #fff;\r\n\t\t\t  position: relative;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-controls {\r\n\t\t\t  display: flex;\r\n\t\t\t  justify-content: space-between;\r\n\t\t\t  align-items: center;\r\n\t\t\t  padding: 10px;\r\n\t\t\t  background: #f8f8f8;\r\n\t\t\t  border-bottom: 1px solid #d8d7d9;\r\n\t\t\t}\r\n\r\n\t\t\t.controls-left {\r\n\t\t\t  display: flex;\r\n\t\t\t  gap: 10px;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn {\r\n\t\t\t  background: #1976d2;\r\n\t\t\t  color: white;\r\n\t\t\t  border: none;\r\n\t\t\t  padding: 8px 16px;\r\n\t\t\t  border-radius: 3px;\r\n\t\t\t  cursor: pointer;\r\n\t\t\t  font-size: 13px;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn:hover {\r\n\t\t\t  background: #1565c0;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn.active {\r\n\t\t\t  background: #ff9800;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn-danger {\r\n\t\t\t  background: #f44336;\r\n\t\t\t  color: white;\r\n\t\t\t  border: none;\r\n\t\t\t  padding: 8px 16px;\r\n\t\t\t  border-radius: 3px;\r\n\t\t\t  cursor: pointer;\r\n\t\t\t  font-size: 13px;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn-danger:hover {\r\n\t\t\t  background: #d32f2f;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-btn-small {\r\n\t\t\t  padding: 4px 8px;\r\n\t\t\t  font-size: 11px;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-count {\r\n\t\t\t  font-size: 12px;\r\n\t\t\t  color: #666;\r\n\t\t\t  font-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-image {\r\n\t\t\t  position: relative;\r\n\t\t\t  display: inline-block;\r\n\t\t\t  max-width: 100%;\r\n\t\t\t  overflow: auto;\r\n\t\t\t  background: #f0f0f0;\r\n\t\t\t  border: 1px solid #ddd;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-image.adding-mode {\r\n\t\t\t  cursor: crosshair;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-image img {\r\n\t\t\t  display: block;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-placeholder-image {\r\n\t\t\t  width: 400px;\r\n\t\t\t  height: 300px;\r\n\t\t\t  background: #f5f5f5;\r\n\t\t\t  border: 2px dashed #ccc;\r\n\t\t\t  display: flex;\r\n\t\t\t  align-items: center;\r\n\t\t\t  justify-content: center;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-hotspot {\r\n\t\t\t  position: absolute;\r\n\t\t\t  width: 24px;\r\n\t\t\t  height: 24px;\r\n\t\t\t  background: var(--hotspot-color, #f60078);\r\n\t\t\t  border: 2px solid white;\r\n\t\t\t  border-radius: 50%;\r\n\t\t\t  cursor: pointer;\r\n\t\t\t  transform: translate(-50%, -50%);\r\n\t\t\t  display: flex;\r\n\t\t\t  align-items: center;\r\n\t\t\t  justify-content: center;\r\n\t\t\t  box-shadow: 0 2px 4px rgba(0,0,0,0.3);\r\n\t\t\t  z-index: 10;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-hotspot:hover {\r\n\t\t\t  transform: translate(-50%, -50%) scale(1.1);\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-hotspot.selected {\r\n\t\t\t  background: #ff9800;\r\n\t\t\t  transform: translate(-50%, -50%) scale(1.2);\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-hotspot.moved {\r\n\t\t\t  border: 2px solid #ffeb3b;\r\n\t\t\t  box-shadow: 0 2px 8px rgba(255, 235, 59, 0.5), 0 0 0 2px rgba(255, 235, 59, 0.3);\r\n\t\t\t}\r\n\r\n\t\t\t.hotspot-number {\r\n\t\t\t  color: white;\r\n\t\t\t  font-size: 10px;\r\n\t\t\t  font-weight: bold;\r\n\t\t\t  line-height: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-panel {\r\n\t\t\t  border-top: 1px solid #d8d7d9;\r\n\t\t\t  background: #fafafa;\r\n\t\t\t}\r\n\r\n\t\t\t.panel-header {\r\n\t\t\t  display: flex;\r\n\t\t\t  justify-content: space-between;\r\n\t\t\t  align-items: center;\r\n\t\t\t  padding: 10px;\r\n\t\t\t  border-bottom: 1px solid #d8d7d9;\r\n\t\t\t}\r\n\r\n\t\t\t.panel-header h4 {\r\n\t\t\t  margin: 0;\r\n\t\t\t  font-size: 14px;\r\n\t\t\t}\r\n\r\n\t\t\t.panel-content {\r\n\t\t\t  padding: 10px;\r\n\t\t\t}\r\n\r\n\t\t\t.panel-content label {\r\n\t\t\t  display: block;\r\n\t\t\t  margin-bottom: 5px;\r\n\t\t\t  font-size: 13px;\r\n\t\t\t  font-weight: 500;\r\n\t\t\t}\r\n\r\n\t\t\t.imagehotspot-textarea {\r\n\t\t\t  width: 100%;\r\n\t\t\t  border: 1px solid #d8d7d9;\r\n\t\t\t  border-radius: 3px;\r\n\t\t\t  padding: 8px;\r\n\t\t\t  font-family: inherit;\r\n\t\t\t  font-size: 13px;\r\n\t\t\t  resize: vertical;\r\n\t\t\t  min-height: 60px;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table-container {\r\n\t\t\t  border-top: 1px solid #d8d7d9;\r\n\t\t\t  background: #fafafa;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table-container h4 {\r\n\t\t\t  margin: 0;\r\n\t\t\t  padding: 10px;\r\n\t\t\t  font-size: 14px;\r\n\t\t\t  border-bottom: 1px solid #d8d7d9;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table {\r\n\t\t\t  width: 100%;\r\n\t\t\t  border-collapse: collapse;\r\n\t\t\t  font-size: 12px;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table th,\r\n\t\t\t.hotspots-table td {\r\n\t\t\t  padding: 8px;\r\n\t\t\t  text-align: left;\r\n\t\t\t  border-bottom: 1px solid #e0e0e0;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table th {\r\n\t\t\t  background: #f0f0f0;\r\n\t\t\t  font-weight: 600;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table tr:hover {\r\n\t\t\t  background: #f8f8f8;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspots-table tr.selected-row {\r\n\t\t\t  background: #e3f2fd;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspot-index {\r\n\t\t\t  width: 40px;\r\n\t\t\t  text-align: center;\r\n\t\t\t  font-weight: bold;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspot-coordinates {\r\n\t\t\t  font-family: monospace;\r\n\t\t\t  font-size: 11px;\r\n\t\t\t}\r\n\r\n\t\t\t.hotspot-actions {\r\n\t\t\t  width: 80px;\r\n\t\t\t}\r\n\r\n\t\t\t/* Theme colors */\r\n\t\t\t.theme1 {\r\n\t\t\t  --hotspot-color: #f60078;\r\n\t\t\t}\r\n\r\n\t\t\t.theme2 {\r\n\t\t\t  --hotspot-color: #4caf50;\r\n\t\t\t}\r\n\r\n\t\t\t.theme3 {\r\n\t\t\t  --hotspot-color: #2196f3;\r\n\t\t\t}\r\n\r\n\t\t\t.theme4 {\r\n\t\t\t  --hotspot-color: #ff9800;\r\n\t\t\t}\r\n\t\t`,\r\n    ];\r\n}\r\n\r\nexport default PropertyEditorHotSpotsEditorElement;\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'property-editor-multi-hotspot-editor': PropertyEditorHotSpotsEditorElement;\r\n    }\r\n}\r\n"],"names":["_PropertyEditorHotSpotsEditorElement_instances","normalizeValue_fn","_documentWorkspaceContext","_documentDetailRepository","_documentItemRepository","_mediaDetailRepository","updateValueAndNotify_fn","selectHotspot_fn","saveHotspotChanges_fn","addHotspotAtPosition_fn","moveHotspotToPosition_fn","validateImageDimensions_fn","validateHotspotCoordinates_fn","validateConfiguredWidth_fn","generateHotspotId_fn","sanitizeInput_fn","getMousePositionFromDragEvent_fn","getHotspotTooltip_fn","removeHotspot_fn","_removeAllHotspots","_toggleAddMode","setConfig_fn","configureImageFromProperty_fn","configureDirectImageSrc_fn","configureMediaImage_fn","configureTheme_fn","setPlaceholderImage_fn","getParentFromUnique_fn","getValueFromUnique_fn","getPropertyValue_fn","renderHotspotMarkers_fn","renderHotspotMarker_fn","renderHotspotTableRows_fn","renderInvalidHotspotRow_fn","renderValidHotspotRow_fn","DEFAULT_IMAGE_WIDTH","DEFAULT_ASPECT_RATIO","HOTSPOT_COORDINATE_PRECISION","MAX_TITLE_LENGTH","MAX_DESCRIPTION_LENGTH","MIN_IMAGE_WIDTH","MAX_IMAGE_WIDTH","DEFAULT_MAP_BOUNDS","THEME_MAPPING","PropertyEditorHotSpotsEditorElement","UmbLitElement","__privateAdd","UmbPropertyEditorConfigCollection","UmbDocumentDetailRepository","UmbDocumentItemRepository","UmbMediaDetailRepository","x","y","__privateMethod","lat","lng","event","hotspotId","position","target","sanitizedTitle","markup","sanitizedMarkup","hotspotsCount","config","val","UMB_DOCUMENT_WORKSPACE_CONTEXT","context","__privateSet","hotspots","html","__privateGet","h","updates","UmbChangeEvent","hotspot","updatedHotspots","id","newHotspot","updatedValue","error","configuredWidth","width","input","maxLength","imageContainer","rect","number","description","filteredHotspots","imagePropertyAlias","imageValue","firstImageValue","mediaKey","src","media","mediaWidth","mediaHeight","umbracoFile","theme","unique","alias","item","value","parentUnique","prop","index","isSelected","hasUnsavedPosition","displayX","displayY","editingPixel","title","e","selectHotspot","deleteHotspot","unsafeHTML","UmbTextStyles","css","__decorateClass","state","property","customElement","PropertyEditorHotSpotsEditorElement_default"],"mappings":"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"}